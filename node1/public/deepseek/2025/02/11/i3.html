<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>马路探照灯</title>
    <style>
        * { margin: 0; padding: 0; }
        canvas { display: block; }
        body { background: #000; overflow: hidden; }
    </style>
</head>
<body>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let lightPos = { x: 0, y: 0 };

// 车辆类
class Vehicle {
    constructor() {
        this.lane = Math.random() > 0.5 ? 1 : -1; // 车道方向
        this.reset();
    }

    reset() {
        this.speed = 2 + Math.random() * 3;
        this.width = 40 + Math.random() * 40;
        this.height = this.width * 0.6;
        this.color = `hsl(${Math.random()*360}, 70%, 50%)`;
        
        if(this.lane === 1) {
            this.x = -this.width;
            this.y = canvas.height/2 + 40;
        } else {
            this.x = canvas.width;
            this.y = canvas.height/2 - 40;
        }
    }

    update() {
        if(this.lane === 1) {
            this.x += this.speed;
            if(this.x > canvas.width) this.reset();
        } else {
            this.x -= this.speed;
            if(this.x < -this.width) this.reset();
        }
    }

    draw() {
        // 绘制车身
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
        
        // 绘制车窗
        ctx.fillStyle = '#A0D8EF';
        ctx.fillRect(
            this.x + this.width*0.1,
            this.y + this.height*0.2,
            this.width*0.8,
            this.height*0.6
        );
    }
}

// 设置画布尺寸
let vehicles = [];
function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    // 初始化车辆
    vehicles = Array.from({length: 20}, () => new Vehicle());
}
window.addEventListener('resize', resize);

// 绘制道路
function drawRoad() {
    // 路面
    ctx.fillStyle = '#333333';
    ctx.fillRect(0, canvas.height/2 - 60, canvas.width, 120);
    
    // 车道线
    ctx.strokeStyle = '#FFFF00';
    ctx.setLineDash([40, 30]);
    ctx.beginPath();
    ctx.moveTo(0, canvas.height/2);
    ctx.lineTo(canvas.width, canvas.height/2);
    ctx.lineWidth = 4;
    ctx.stroke();
}

// 主绘制函数
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // 绘制道路
    drawRoad();
    
    // 更新并绘制车辆
    vehicles.forEach(vehicle => {
        vehicle.update();
        vehicle.draw();
    });
    
    // 添加黑暗层和灯光效果
    const gradient = ctx.createRadialGradient(
        lightPos.x, lightPos.y, 0,
        lightPos.x, lightPos.y, 250
    );
    gradient.addColorStop(0, 'rgba(0, 0, 0, 0)');
    gradient.addColorStop(1, 'rgba(0, 0, 0, 0.95)');
    
    ctx.globalCompositeOperation = 'source-over';
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    requestAnimationFrame(draw);
}

// 输入处理
canvas.addEventListener('mousemove', e => {
    lightPos.x = e.clientX;
    lightPos.y = e.clientY;
});

canvas.addEventListener('touchmove', e => {
    e.preventDefault();
    lightPos.x = e.touches[0].clientX;
    lightPos.y = e.touches[0].clientY;
}, { passive: false });

// 初始化
resize();
requestAnimationFrame(draw);
</script>
</body>
</html>