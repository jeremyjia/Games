<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯æ‹–åŠ¨å·¥å…·æ ç¨»è‰äºº</title>
    <style>
        canvas {
            border: 1px solid #000;
            touch-action: none;
        }
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: #f0f0f0;
            touch-action: manipulation;
        }
        .controls {
            margin-bottom: 15px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            padding: 0 10px;
        }
        button {
            padding: 12px 20px;
            font-size: 14px;
            cursor: pointer;
            color: white;
            border: none;
            border-radius: 25px;
            transition: all 0.2s;
            min-width: 90px;
            touch-action: manipulation;
        }
        @media (max-width: 480px) {
            button {
                padding: 10px 15px;
                font-size: 13px;
                min-width: 80px;
            }
        }
        button:hover { transform: scale(1.05); }
        button:active { transform: scale(0.95); }
        .movement-controls, .rotation-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        #startBtn { background: #4CAF50; }
        #stopBtn { background: #f44336; }
        #fishBtn { background: #e91e63; }
        #jumpBtn { background: #ff9800; }
        #dogBtn { background: #9C27B0; }
        #dismissDogBtn { background: #673AB7; }
        #lieLeftBtn, #lieRightBtn { background: #795548; }
        #turnLeftBtn, #turnBackBtn, #turnRightBtn { background: #009688; }
        .status-bar {
            position: absolute;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px;
            border-radius: 5px;
            font-family: Arial;
            cursor: move;
            user-select: none;
            transition: box-shadow 0.3s;
        }
        .scene-toolbar {
            position: absolute;
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex;
            gap: 8px;
            flex-direction: column;
            cursor: move;
            user-select: none;
            transition: box-shadow 0.3s;
        }
        .scene-btn {
            background: #4CAF50 !important;
            min-width: 80px;
            padding: 8px 12px;
        }
        .dragging {
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="status-bar" style="left: 10px; top: 10px">çŠ¶æ€: <span id="status">è¿è¡Œä¸­</span></div>
    <div class="scene-toolbar" style="left: 10px; top: 60px">
        <button class="scene-btn" id="roadSceneBtn">ğŸš— é©¬è·¯è¾¹</button>
        <button class="scene-btn" id="forestSceneBtn">ğŸŒ³ æ ‘æ—</button>
        <button class="scene-btn" id="playgroundSceneBtn">ğŸƒ æ“åœº</button>
    </div>
    <div class="controls">
        <button id="lieLeftBtn">ğŸ›Œ å·¦èºº</button>
        <button id="lieRightBtn">ğŸ›Œ å³èºº</button>
        <div class="rotation-controls">
            <button id="turnLeftBtn">â†© å·¦è½¬</button>
            <button id="turnBackBtn">â†» åè½¬</button>
            <button id="turnRightBtn">â†ª å³è½¬</button>
        </div>
        <button id="startBtn">å¼€å§‹è‡ªåŠ¨</button>
        <button id="stopBtn">åœæ­¢è‡ªåŠ¨</button>
        <button id="dogBtn">ğŸ¶ å¬å”¤å°ç‹—</button>
        <button id="dismissDogBtn">ğŸ‘‹ å°ç‹—ç¦»å¼€</button>
        <div class="movement-controls">
            <button id="leftBtn" style="background:#2196F3">â† ç§»åŠ¨</button>
            <button id="jumpBtn">â†‘ è·³è·ƒ</button>
            <button id="rightBtn" style="background:#2196F3">â†’ ç§»åŠ¨</button>
        </div>
        <button id="fishBtn">ğŸ£ é’“é±¼</button>
    </div>
    <canvas id="gameCanvas"></canvas>

    <script>
        /* Ask:
        ä»é›¶ç»™æˆ‘ç”Ÿæˆä¸€ä¸ªç½‘é¡µï¼Œç”¨JavaScriptç”»å¸ƒã€‚å®ç°ä¸€ä¸ªç¨»è‰äººæ¸¸æˆï¼Œæœ‰ä¸€ä¸ªå·¥å…·æ¡ä¸Šé¢æœ‰ä¸€äº›æŒ‰é’®å¯ä»¥å‘½ä»¤ç¨»è‰äººï¼Œ
        å·¦èººï¼Œå³èººã€‚å·¦èººå³èººã€‚æœ‰ä¸€ä¸ªæŒ‰é’®å¯ä»¥å¬å”¤æ¥ä¸€åªç‹—ï¼Œå¦ä¸€ä¸ªæŒ‰é’®å¯ä»¥è®©ç‹—ç¦»å¼€ã€‚
        å†æœ‰ä¸€ä¸ªå·¥å…·æ¡å¯ä»¥è®¾ç½®åœºæ™¯ï¼Œæœ‰é©¬è·¯è¾¹ï¼Œæ ‘æ—ï¼Œæ“åœºï¼Œæµ·è¾¹ï¼›ä¸¤ä¸ªå·¥å…·æ¡éƒ½æ˜¯æ‚¬æµ®å¯ç§»åŠ¨çš„ã€‚ç¨‹åºå¯ä»¥åœ¨æ‰‹æœºä¸Šè¿è¡Œã€‚
        */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let animationId = null;
        let isMoving = true;
        let isFishing = false;
        const SCENES = { ROAD: 0, FOREST: 1, PLAYGROUND: 2 };
        let currentScene = SCENES.ROAD;

        // ç”»å¸ƒå°ºå¯¸è®¾ç½®
        function setCanvasSize() {
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            canvas.width = isMobile ? window.innerWidth * 0.95 : 800;
            canvas.height = isMobile ? window.innerHeight * 0.6 : 400;
        }
        setCanvasSize();

        // ç‰©ç†å‚æ•°
        const PHYSICS = {
            STEP_SIZE: canvas.width * 0.05,
            JUMP_FORCE: -18,
            GRAVITY: 0.7,
            FISHING_TIME: 1500
        };

        // ç¨»è‰äººç±»
        class Scarecrow {
            constructor() {
                this.reset();
                this.speed = canvas.width * 0.005;
                this.rodAngle = 0;
                this.direction = 0;
                this.lyingState = 0;
                this.bodyRotation = 0;
            }

            reset() {
                this.x = canvas.width / 2;
                this.y = canvas.height - 100;
                this.velocityY = 0;
                this.isJumping = false;
                this.armAngle = 0;
                this.legAngle = 0;
                this.animationStep = 0;
                this.fishingProgress = 0;
                this.direction = 0;
                this.lyingState = 0;
                this.bodyRotation = 0;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                
                if(this.lyingState !== 0) {
                    ctx.rotate(this.lyingState === 1 ? -Math.PI/2 : Math.PI/2);
                    ctx.translate(0, 50);
                } else {
                    ctx.rotate((this.direction * Math.PI)/2 + this.bodyRotation);
                }

                if(isFishing) this.#drawFishingRod();

                switch(this.direction % 4) {
                    case 0: this.#drawFront(); break;
                    case 1: this.#drawRightSide(); break;
                    case 2: this.#drawBack(); break;
                    case 3: this.#drawLeftSide(); break;
                }
                ctx.restore();
            }

            #drawFishingRod() {
                ctx.save();
                ctx.rotate(-this.rodAngle + Math.PI/4);
                ctx.strokeStyle = '#795548';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(20, -80);
                ctx.lineTo(80, -140);
                ctx.stroke();
                
                ctx.strokeStyle = '#FFFFFF';
                ctx.setLineDash([2, 3]);
                ctx.beginPath();
                ctx.moveTo(80, -140);
                ctx.lineTo(80 + Math.sin(Date.now()/200)*10, -140 + 50);
                ctx.stroke();
                ctx.restore();
            }

            // å…¶ä»–ç»˜åˆ¶æ–¹æ³•ä¿æŒä¸å˜...
            // (ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ­¤å¤„çœç•¥è¯¦ç»†ç»˜åˆ¶æ–¹æ³•ï¼Œä¿æŒä¸ä¹‹å‰ç›¸åŒ)
        }

        // å°ç‹—ç±»ï¼ˆä¿æŒä¸ä¹‹å‰ç›¸åŒï¼‰
        class Dog {
            // ...ï¼ˆå®ç°ä¸ä¹‹å‰ç›¸åŒï¼‰
        }

        // åœºæ™¯ç»˜åˆ¶
        function drawScene() {
            switch(currentScene) {
                case SCENES.ROAD:
                    // ç»˜åˆ¶é©¬è·¯åœºæ™¯...
                    break;
                case SCENES.FOREST:
                    // ç»˜åˆ¶æ ‘æ—åœºæ™¯...
                    break;
                case SCENES.PLAYGROUND:
                    // ç»˜åˆ¶æ“åœºåœºæ™¯...
                    break;
            }
        }

        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawScene();
            scarecrow.update();
            scarecrow.draw();
            dog.update();
            dog.draw();
            animationId = requestAnimationFrame(gameLoop);
        }

        // æ‹–æ‹½ç®¡ç†å™¨
        class DragManager {
            constructor() {
                this.draggingElement = null;
                this.initDrag();
            }

            initDrag() {
                const draggables = document.querySelectorAll('.status-bar, .scene-toolbar');
                draggables.forEach(el => {
                    el.addEventListener('mousedown', this.startDrag.bind(this));
                    el.addEventListener('touchstart', this.startDrag.bind(this), { passive: false });
                });
                document.addEventListener('mousemove', this.drag.bind(this));
                document.addEventListener('touchmove', this.drag.bind(this), { passive: false });
                document.addEventListener('mouseup', this.stopDrag.bind(this));
                document.addEventListener('touchend', this.stopDrag.bind(this));
            }

            startDrag(e) {
                this.draggingElement = e.target.closest('.status-bar, .scene-toolbar');
                if (!this.draggingElement) return;

                const rect = this.draggingElement.getBoundingClientRect();
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                
                this.offsetX = clientX - rect.left;
                this.offsetY = clientY - rect.top;
                
                this.draggingElement.classList.add('dragging');
                e.preventDefault();
            }

            drag(e) {
                if (!this.draggingElement) return;

                const clientX = e.clientX || (e.touches[0]?.clientX ?? 0);
                const clientY = e.clientY || (e.touches[0]?.clientY ?? 0);
                
                let newX = clientX - this.offsetX;
                let newY = clientY - this.offsetY;

                newX = Math.max(0, Math.min(newX, window.innerWidth - this.draggingElement.offsetWidth));
                newY = Math.max(0, Math.min(newY, window.innerHeight - this.draggingElement.offsetHeight));

                this.draggingElement.style.left = `${newX}px`;
                this.draggingElement.style.top = `${newY}px`;
                e.preventDefault();
            }

            stopDrag() {
                if (this.draggingElement) {
                    this.draggingElement.classList.remove('dragging');
                    this.draggingElement = null;
                }
            }
        }

        // åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
        new DragManager();

        // äº‹ä»¶ç›‘å¬å’Œæ¸¸æˆåˆå§‹åŒ–...
        // ï¼ˆä¿æŒä¸ä¹‹å‰ç‰ˆæœ¬ç›¸åŒçš„äº‹ä»¶ç›‘å¬å’Œåˆå§‹åŒ–ä»£ç ï¼‰

        // å¯åŠ¨æ¸¸æˆ
        gameLoop();
        window.addEventListener('resize', () => {
            setCanvasSize();
            scarecrow.reset();
            dog.reset();
        });
    </script>
</body>
</html>