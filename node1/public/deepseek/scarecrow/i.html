<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½ç¨»è‰äºº</title>
    <style>
        canvas {
            border: 1px solid #000;
            background: #87CEEB;
            touch-action: none;
        }
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: #f0f0f0;
            touch-action: manipulation;
        }
        .controls {
            margin-bottom: 15px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            padding: 0 10px;
        }
        button {
            padding: 12px 20px;
            font-size: 14px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            transition: all 0.2s;
            min-width: 90px;
            touch-action: manipulation;
        }
        @media (max-width: 480px) {
            button {
                padding: 10px 15px;
                font-size: 13px;
                min-width: 80px;
            }
        }
        button:hover {
            transform: scale(1.05);
        }
        button:active {
            transform: scale(0.95);
        }
        .movement-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        #fishBtn { background: #e91e63; }
        #jumpBtn { background: #ff9800; }
        .status-bar {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px;
            border-radius: 5px;
            font-family: Arial;
        }
    </style>
</head>
<body>
    <div class="status-bar">çŠ¶æ€: <span id="status">è¿è¡Œä¸­</span></div>
    <div class="controls">
        <button id="startBtn">å¼€å§‹è‡ªåŠ¨</button>
        <button id="stopBtn">åœæ­¢è‡ªåŠ¨</button>
        <div class="movement-controls">
            <button id="leftBtn" style="background:#2196F3">â† ç§»åŠ¨</button>
            <button id="jumpBtn">â†‘ è·³è·ƒ</button>
            <button id="rightBtn" style="background:#2196F3">â†’ ç§»åŠ¨</button>
        </div>
        <button id="fishBtn">ğŸ£ é’“é±¼</button>
    </div>
    <canvas id="gameCanvas"></canvas>

    <script>
        //å†å‡çº§ä¸€ä¸‹ï¼Œåœæ­¢çš„æ—¶å€™æ‰‹è„šä¸è¦åŠ¨ã€‚
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let animationId = null;
        let isMoving = true;
        let isFishing = false;
        
        // åŠ¨æ€å°ºå¯¸è®¾ç½®
        function setCanvasSize() {
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            canvas.width = isMobile ? window.innerWidth * 0.95 : 800;
            canvas.height = isMobile ? window.innerHeight * 0.6 : 400;
        }
        setCanvasSize();

        const PHYSICS = {
            STEP_SIZE: canvas.width * 0.05,
            JUMP_FORCE: -18,
            GRAVITY: 0.7,
            FISHING_TIME: 1500
        };

        class Scarecrow {
            constructor() {
                this.reset();
                this.speed = canvas.width * 0.005;
                this.rodAngle = 0;
            }

            reset() {
                this.x = canvas.width / 2;
                this.y = canvas.height - 100;
                this.direction = 1;
                this.velocityY = 0;
                this.isJumping = false;
                this.armAngle = 0;
                this.legAngle = 0;
                this.animationStep = 0;
                this.fishingProgress = 0;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);

                // ç»˜åˆ¶é’“ç«¿
                if(isFishing) {
                    ctx.save();
                    ctx.rotate(-this.rodAngle + Math.PI/4);
                    ctx.strokeStyle = '#795548';
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    ctx.moveTo(20, -80);
                    ctx.lineTo(80, -140);
                    ctx.stroke();
                    
                    // é±¼çº¿
                    ctx.strokeStyle = '#FFFFFF';
                    ctx.setLineDash([2, 3]);
                    ctx.beginPath();
                    ctx.moveTo(80, -140);
                    ctx.lineTo(80 + Math.sin(Date.now()/200)*10, -140 + 50);
                    ctx.stroke();
                    ctx.restore();
                }

                // èº«ä½“
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(-15, -80, 30, 80);

                // å¤´éƒ¨
                ctx.beginPath();
                ctx.arc(0, -100, 20, 0, Math.PI * 2);
                ctx.fillStyle = '#FFD700';
                ctx.fill();

                // å¸½å­
                ctx.fillStyle = '#A0522D';
                ctx.beginPath();
                ctx.arc(0, -110, 25, 0, Math.PI);
                ctx.fill();

                // æ‰‹è‡‚
                this.#drawArm(-15, -this.armAngle);
                this.#drawArm(15, this.armAngle);

                // è…¿éƒ¨
                this.#drawLeg(-10, -this.legAngle);
                this.#drawLeg(10, this.legAngle);

                ctx.restore();
            }

            #drawArm(startX, angle) {
                ctx.save();
                ctx.rotate(angle);
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 8;
                ctx.beginPath();
                ctx.moveTo(startX, -80);
                ctx.lineTo(startX*2, -50);
                ctx.stroke();
                ctx.restore();
            }

            #drawLeg(startX, angle) {
                ctx.save();
                ctx.rotate(angle);
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.moveTo(startX, 0);
                ctx.lineTo(startX*1.5, 40);
                ctx.stroke();
                ctx.restore();
            }

            update() {
                // è‡ªåŠ¨ç§»åŠ¨
                if (isMoving) {
                    this.x += this.speed * this.direction;
                    if (this.x > canvas.width - 50 || this.x < 50) {
                        this.direction *= -1;
                    }
                }

                // åŠ¨ç”»ç³»ç»Ÿ
                this.animationStep = (this.animationStep + 1) % 60;
                this.armAngle = Math.sin(this.animationStep * 0.1) * 0.5;
                this.legAngle = Math.cos(this.animationStep * 0.1) * 0.3;

                // è·³è·ƒç‰©ç†
                if (this.isJumping) {
                    this.y += this.velocityY;
                    this.velocityY += PHYSICS.GRAVITY;
                    if (this.y >= canvas.height - 100) {
                        this.y = canvas.height - 100;
                        this.velocityY = 0;
                        this.isJumping = false;
                    }
                }

                // é’“é±¼åŠ¨ç”»
                if(isFishing) {
                    this.rodAngle = Math.sin(Date.now()/200) * 0.2;
                }
            }
        }

        const scarecrow = new Scarecrow();

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶åœºæ™¯
            ctx.fillStyle = '#90EE90';
            ctx.fillRect(0, canvas.height - 60, canvas.width, 60);
            ctx.fillStyle = '#4682B4';
            ctx.fillRect(0, canvas.height - 40, canvas.width, 40);
            
            scarecrow.update();
            scarecrow.draw();
            
            animationId = requestAnimationFrame(gameLoop);
        }

        // æ§åˆ¶å‡½æ•°
        function startAuto() {
            isMoving = true;
            document.getElementById('status').textContent = 'è‡ªåŠ¨è¿è¡Œä¸­';
            gameLoop();
        }

        function stopAuto() {
            isMoving = false;
            document.getElementById('status').textContent = 'å·²åœæ­¢';
        }

        function move(direction) {
            const newX = scarecrow.x + (PHYSICS.STEP_SIZE * direction);
            scarecrow.x = Math.max(50, Math.min(canvas.width - 50, newX));
            scarecrow.direction = direction;
        }

        function jump() {
            if (!scarecrow.isJumping) {
                scarecrow.velocityY = PHYSICS.JUMP_FORCE;
                scarecrow.isJumping = true;
            }
        }

        function fish() {
            if(!isFishing) {
                isFishing = true;
                document.getElementById('status').textContent = 'é’“é±¼ä¸­...';
                setTimeout(() => {
                    isFishing = false;
                    document.getElementById('status').textContent = isMoving ? 'è‡ªåŠ¨è¿è¡Œä¸­' : 'å·²åœæ­¢';
                }, PHYSICS.FISHING_TIME);
            }
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('startBtn').addEventListener('click', startAuto);
        document.getElementById('stopBtn').addEventListener('click', stopAuto);
        document.getElementById('leftBtn').addEventListener('click', () => move(-1));
        document.getElementById('rightBtn').addEventListener('click', () => move(1));
        document.getElementById('jumpBtn').addEventListener('click', jump);
        document.getElementById('fishBtn').addEventListener('click', fish);

        // è§¦æ‘¸äº‹ä»¶æ”¯æŒ
        document.querySelectorAll('button').forEach(btn => {
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                btn.click();
            });
        });

        // åˆå§‹åŒ–
        gameLoop();
        window.addEventListener('resize', () => {
            setCanvasSize();
            scarecrow.reset();
        });
    </script>
</body>
</html>