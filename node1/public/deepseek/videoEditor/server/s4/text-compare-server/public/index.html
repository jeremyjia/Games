<!DOCTYPE html>
<html>
<head>
    <title>文本对比工具</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/diff/5.0.0/diff.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="text-boxes">
            <textarea id="text1" placeholder="输入原始文本..."></textarea>
            <textarea id="text2" placeholder="输入修改后的文本..."></textarea>
        </div>
        
        <div class="buttons">
            <button onclick="compareText()">对比文本</button>
            <button onclick="generateWord()">生成Word文档</button>
        </div>

        <div id="diffResult"></div>
        <div id="downloadLink"></div>
    </div>

    <script>
        let diffs = [];

        function compareText() {
            const text1 = document.getElementById('text1').value;
            const text2 = document.getElementById('text2').value;
            
            diffs = Diff.diffWords(text1, text2);
            
            const display = diffs.map(part => {
                const className = part.added ? 'added' : part.removed ? 'removed' : '';
                return `<span class="${className}">${part.value}</span>`;
            }).join('');
            
            document.getElementById('diffResult').innerHTML = display;
        }

        async function generateWord() {
            if (diffs.length === 0) {
                alert('请先进行文本对比！');
                return;
            }

            try {
                const response = await fetch('/generate-doc', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ diffs })
                });

                const data = await response.json();
                const linkContainer = document.getElementById('downloadLink');
                linkContainer.innerHTML = `
                    <a href="${data.url}" class="download-link">
                        ↓ 下载对比文档（${data.url.split('/').pop()}）
                    </a>
                `;
            } catch (error) {
                alert('生成文档失败');
            }
        }
    </script>
</body>
</html>