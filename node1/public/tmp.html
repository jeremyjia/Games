<!DOCTYPE html>
<html lang="en">

<head>
    <!-- 其他头部内容保持不变 -->
    <title>手机编程系统 v0.34</title>
    <style>
        /* 原有样式保持不变 */
        .uninstall-btn {
            transition: all 0.2s;
            padding: 2px 6px;
            border-radius: 50%;
        }
        .uninstall-btn:hover {
            background-color: #dc2626;
            color: white;
        }
    </style>
</head>

<body class="bg-gray-100">
    <script>
        class C4Plugin {
            // 原有构造函数保持不变
            
            showDetail() {
                const detailWindow = document.createElement('div');
                detailWindow.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 bg-white rounded-lg shadow-xl p-4 plugin-detail-window';
                detailWindow.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold">${this.name}</h3>
                        <button onclick="this.parentElement.parentElement.remove()" 
                                class="close-btn px-2 py-1 hover:bg-gray-100 rounded">×</button>
                    </div>
                    <div class="plugin-detail-content space-y-2 text-sm">
                        <p><strong>版本:</strong> ${this.version}</p>
                        <p><strong>状态:</strong> ${this.enabled ? '已启用' : '已禁用'}</p>
                        <p><strong>安装时间:</strong> ${this.installTime}</p>
                        <p><strong>描述:</strong> ${this.description}</p>
                        <div class="flex gap-2 mt-4">
                            <button onclick="this.parentElement.querySelector('pre').classList.toggle('hidden')"
                                    class="flex-1 p-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                                查看代码
                            </button>
                            <button class="uninstall-btn flex-1 p-2 bg-red-500 text-white rounded hover:bg-red-600"
                                    onclick="app._uninstallPlugin('${this.name}')">
                                卸载
                            </button>
                        </div>
                        <pre class="bg-gray-100 p-2 rounded text-xs hidden">${this.code}</pre>
                    </div>
                `;
                document.body.appendChild(detailWindow);
            }

            // 其他方法保持不变
        }

        class C4MobileDevApp {
            constructor() {
                this.version = "0.35";  // 更新版本号
                // 其他初始化代码保持不变
            }

            // 新增卸载方法
            _uninstallPlugin(pluginName) {
                if (confirm(`确定要卸载 ${pluginName} 吗？`)) {
                    this.plis = this.plis.filter(p => p.name !== pluginName);
                    this.#savePlugins();
                    this.#refreshPluginList();
                    // 关闭所有相关详情窗口
                    document.querySelectorAll('.plugin-detail-window').forEach(wnd => wnd.remove());
                }
            }

            #refreshPluginList() {
                const pluginList = document.getElementById('id_4_installed_plugins_list');
                pluginList.innerHTML = '';

                if (this.plis.length === 0) {
                    pluginList.innerHTML = '<div class="p-2 bg-gray-100 mb-2 rounded">还没安装插件。</div>';
                    return;
                }

                this.plis.forEach(plugin => {
                    const pluginItem = document.createElement('div');
                    pluginItem.className = 'plugin-item p-2 bg-gray-100 mb-2 rounded cursor-pointer flex justify-between items-center';
                    pluginItem.innerHTML = `
                        <div>
                            <span class="font-medium">${plugin.name}</span>
                            <span class="text-xs text-gray-500 ml-2">v${plugin.version}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-xs ${plugin.enabled ? 'text-green-500' : 'text-red-500'}">
                                ${plugin.enabled ? '已启用' : '已禁用'}
                            </span>
                            <button class="uninstall-btn px-2 py-1 hover:bg-red-100 rounded"
                                    onclick="app._uninstallPlugin('${plugin.name}')">
                                ×
                            </button>
                        </div>
                    `;
                    pluginItem.addEventListener('click', () => plugin.showDetail());
                    pluginList.appendChild(pluginItem);
                });
            }

            // 其他方法保持不变
        }

        // 其余代码保持不变
    </script>
</body>
</html>