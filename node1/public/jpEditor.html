<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <title>简谱编辑系统</title>
</head>

<body class="bg-gray-100">
    <script>
        class SheetMusicEditor {
            constructor() {
                this.createElements();
                this.applyStyles();
                this.addEventListeners();
            }

            createElements() {
                this.canvas = document.createElement('div');
                this.canvas.id = 'canvas';

                this.toolbar = document.createElement('div');
                this.toolbar.classList.add('fixed', 'bottom-0', 'left-0', 'right-0', 'bg-white', 'p-4', 'shadow-md');

                this.settingsButton = document.createElement('button');
                this.settingsButton.id = 'settings-button';
                this.settingsButton.classList.add('bg-blue-500', 'hover:bg-blue-600', 'text-white', 'py-2', 'px-4', 'rounded');
                this.settingsButton.innerHTML = '<i class="fa-solid fa-gear"></i> 设置';
                this.toolbar.appendChild(this.settingsButton);

                this.settingsModal = document.createElement('div');
                this.settingsModal.id = 'settings-modal';

                this.settingsModalHeader = document.createElement('div');
                this.settingsModalHeader.id = 'settings-modal-header';
                this.settingsModalHeader.innerHTML = '<h2 class="text-xl font-bold">简谱设置</h2>';
                this.settingsModal.appendChild(this.settingsModalHeader);

                this.sheetMusicInput = document.createElement('textarea');
                this.sheetMusicInput.id = 'sheet-music-input';
                this.sheetMusicInput.classList.add('w-full', 'h-48', 'border', 'border-gray-300', 'p-2', 'mb-4');
                this.sheetMusicInput.placeholder = '输入简谱';
                this.settingsModal.appendChild(this.sheetMusicInput);

                this.closeModalButton = document.createElement('button');
                this.closeModalButton.id = 'close-modal-button';
                this.closeModalButton.classList.add('bg-red-500', 'hover:bg-red-600', 'text-white', 'py-2', 'px-4', 'rounded');
                this.closeModalButton.innerHTML = '<i class="fa-solid fa-xmark"></i> 关闭';
                this.settingsModal.appendChild(this.closeModalButton);

                document.body.appendChild(this.canvas);
                document.body.appendChild(this.toolbar);
                document.body.appendChild(this.settingsModal);
            }

            applyStyles() {
                const style = document.createElement('style');
                style.textContent = `
                    #canvas {
                        width: 100%;
                        height: calc(100vh - 64px);
                        border: 1px solid #ccc;
                    }
                    #settings-modal {
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background-color: white;
                        padding: 20px;
                        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
                        display: none;
                    }
                    #settings-modal-header {
                        cursor: move;
                        padding: 10px;
                        background-color: #f0f0f0;
                        margin: -20px -20px 20px -20px;
                    }
                `;
                document.head.appendChild(style);
            }

            addEventListeners() {
                let isDragging = false;
                let offsetX, offsetY;

                this.settingsButton.addEventListener('click', () => {
                    this.settingsModal.style.display = 'block';
                });

                this.closeModalButton.addEventListener('click', () => {
                    this.settingsModal.style.display = 'none';
                });

                this.sheetMusicInput.addEventListener('input', () => {
                    const sheetMusic = this.sheetMusicInput.value;
                    this.canvas.innerHTML = `<pre>${sheetMusic}</pre>`;
                });

                this.settingsModalHeader.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    offsetX = e.clientX - this.settingsModal.offsetLeft;
                    offsetY = e.clientY - this.settingsModal.offsetTop;
                });

                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        this.settingsModal.style.left = `${e.clientX - offsetX}px`;
                        this.settingsModal.style.top = `${e.clientY - offsetY}px`;
                    }
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
            }
        }

        new SheetMusicEditor();
    </script>
</body>

</html>
    